<div class="offcanvas offcanvas-end" id="modalSearch" tabindex="-1" role="dialog" aria-hidden="true">

  <!-- Close -->
  <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close">
    <i class="fe fe-x" aria-hidden="true"></i>
  </button>

  <!-- Header-->
  <div class="offcanvas-header lh-fixed fs-lg">
    <strong class="mx-auto">Search Products</strong>
  </div>

  <!-- Body: Form -->
  <div class="offcanvas-body">
    <div class="form-group">
      <label class="visually-hidden" for="modalSearchCategories">Categories:</label>
      <select class="form-select" id="modalSearchCategories" name="category">
        <option value="All Categories" {% if category == 'All Categories' %}selected{% endif %}>All Categories</option>
        <!-- Loop through categories from the database -->
        {% for category in categories %}
          <option value="{{ category.name }}">{{ category.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="input-group input-group-merge mt-3">
      <input class="form-control" type="search" id="searchInput" placeholder="Search for products..." autocomplete="off">
      <button class="btn btn-outline-secondary" type="button" id="searchButton">
        <i class="fas fa-search"></i>
      </button>
    </div>
    <div class="form-text mt-1 text-muted">Start typing to see instant results</div>

    <!-- Traditional search form (hidden, for fallback) -->
    <form method="get" action="{% url 'search_products' %}" id="traditionalSearchForm" class="d-none">
      <input type="hidden" name="search" id="traditionalSearchInput">
      <input type="hidden" name="category" id="traditionalSearchCategory">
    </form>
  </div>

  <!-- Body: Results -->
  <div class="offcanvas-body border-top fs-sm">
    <!-- Heading -->
    <p>Search Results:</p>

    <!-- Results Container -->
    <div id="searchResults">
      <!-- Results will be populated by JavaScript -->
      <div class="row align-items-center position-relative mb-5">
        <div class="col">
          <p class="mb-3 fs-sm text-center">Type at least 2 characters to search</p>
        </div>
      </div>
    </div>

    <!-- Button -->
    <a class="btn btn-link px-0 text-reset" href="{% url 'shop' %}">
      View All Products <i class="fas fa-arrow-right ms-2"></i>
    </a>
  </div>

</div>

<!-- Add JavaScript for live search -->
{% load static %}
<script src="{% static 'js/live-search.js' %}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Update the search endpoint in the configuration
    LiveSearch.config.searchEndpoint = "{% url 'api_search_products' %}";

    // Initialize the live search
    LiveSearch.init();

    // Add event listener for the search button
    document.getElementById('searchButton').addEventListener('click', function() {
      const searchTerm = document.getElementById('searchInput').value.trim();
      const categoryValue = document.getElementById('modalSearchCategories').value;

      // If search term is too short, show a message
      if (searchTerm.length < 2) {
        alert('Please enter at least 2 characters to search');
        return;
      }

      // For longer searches, submit the traditional form for a full page search
      document.getElementById('traditionalSearchInput').value = searchTerm;
      document.getElementById('traditionalSearchCategory').value = categoryValue;
      document.getElementById('traditionalSearchForm').submit();
    });
  });
</script>
